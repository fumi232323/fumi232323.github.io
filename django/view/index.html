<!DOCTYPE html>
<html lang="ja-JP">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <title>Django: View/32imuf.com</title>
    <link rel="shortcut icon" href="/static/icons/favicon.ico">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Griffy">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Vollkorn:400,700">
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/sawarabimincho.css"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/style.css?20190429">
  </head>

  <body>
    <div class="container">
      <div class="header"><header class="item item-header">
  <h1>
    <a href="/">
      <img class="logo" src="/static/images/inuu.png" alt="犬">
    </a>
  </h1>
  <nav class="nav">
    <ul>
      <li class="nav-category"><a href="/">HOME</a></li>
      
      
        
        <li class="nav-category">
          <a href="/index_category_category_aws.html">aws</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../aws/what-is-amazon-aurora/">Amazon Aurora とはなんですか？</a>
              </li>
            
              <li class="nav-article">
                <a href="../../aws/s3-response-error/">S3ResponseError の原因はなんと時刻ずれだった</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_blog.html">blog</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../blog/rules/">ブログを書くときの注意点</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_css.html">css</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../html-css/css/note/">CSS のメモ</a>
              </li>
            
              <li class="nav-article">
                <a href="../../html-css/configure-stylus-output-directory/">PyCharm の File Watcher で、 Stylus の CSS ファイル生成先ディレクトリを指定する。</a>
              </li>
            
              <li class="nav-article">
                <a href="../../html-css/stylus/">Stylus を使う</a>
              </li>
            
              <li class="nav-article">
                <a href="../../html-css/html5-css3-modern-coding/">『HTML5/CSS3モダンコーディング フロントエンドエンジニアが教える3つの本格レイアウト スタンダード・グリッド・シングルページレイアウトの作り方』を読んで気になったことメモ</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_django.html">django</a>
          <ul>
            
              <li class="nav-article">
                <a href="../manage/">Django: django-admin.py, manage.py</a>
              </li>
            
              <li class="nav-article">
                <a href="./">Django: View</a>
              </li>
            
              <li class="nav-article">
                <a href="../urlconf/">Django: URL ディスパッチャ, URLconf</a>
              </li>
            
              <li class="nav-article">
                <a href="../model/">Django: Model, Django ORM</a>
              </li>
            
              <li class="nav-article">
                <a href="../note/">Django なんでもメモ</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_docker.html">docker</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../docker/create-django-env-with-docker-compose-2/">Docker Compose で Django 環境をつくろう その2</a>
              </li>
            
              <li class="nav-article">
                <a href="../../docker/connect-from-sqla-to-mysqldb/">Docker Compose で MySQL DB をつくり Compose 外 (非 docker) の SQLAlchemy から接続する</a>
              </li>
            
              <li class="nav-article">
                <a href="../../docker/create-django-env-with-docker-compose-mysql-2/">Docker Compose で Django/MySQL 環境をつくる その2</a>
              </li>
            
              <li class="nav-article">
                <a href="../../docker/create-django-env-with-docker-compose-mysql/">Docker Compose で Django/MySQL 環境をつくる</a>
              </li>
            
              <li class="nav-article">
                <a href="../../docker/use-volumes-with-docker-compose/">Docker Compose で Volumes をつかう</a>
              </li>
            
              <li class="nav-article">
                <a href="../../docker/create-django-env-with-docker-compose/">Docker Compose で Django/PostgreSQL 環境をつくる</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_git.html">git</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../git/command/merge/">git merge</a>
              </li>
            
              <li class="nav-article">
                <a href="../../git/command/rebase-i/">git rebase -i</a>
              </li>
            
              <li class="nav-article">
                <a href="../../git/command/rebase/">git rebase</a>
              </li>
            
              <li class="nav-article">
                <a href="../../git/note/">Git のメモ</a>
              </li>
            
              <li class="nav-article">
                <a href="../../git/configuration/">Git の設定まとめ</a>
              </li>
            
              <li class="nav-article">
                <a href="../../git/command/">Git のコマンドまとめ</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_github.html">github</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../github/how-to-create-new-repository/">GitHub に新しいリポジトリを作成して、pushする</a>
              </li>
            
              <li class="nav-article">
                <a href="../../github/github-pages-custom-domain-setting/">GitHub Pages にカスタムドメインを設定する</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_mac.html">mac</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../mac/note/">Mac のメモ</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_miyadaiku.html">miyadaiku</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../miyadaiku/build/">Miyadaiku ビルドするときのコマンド</a>
              </li>
            
              <li class="nav-article">
                <a href="../../miyadaiku/article-directory-structure/">article の置きかた</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_mysql.html">mysql</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../mysql/note/">MySQL のメモ</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_pycharm.html">pycharm</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../pycharm/django-support/">Pycharm の Django support を使う</a>
              </li>
            
              <li class="nav-article">
                <a href="../../pycharm/add-psql-var-to-user-params-for-db-console/">PyCharm の Database Console で PostgreSQL のプレースホルダー (インタポレーション) を SQL パラメーターとして使えるようにする</a>
              </li>
            
              <li class="nav-article">
                <a href="../../pycharm/connect-db-using-ssh-tunnel/">PyCharm で SSH tunnel して Amazon Redshift につなぐ</a>
              </li>
            
              <li class="nav-article">
                <a href="../../pycharm/useful-menu-and-shortcuts/">PyCharm ショートカットと便利メニュー</a>
              </li>
            
              <li class="nav-article">
                <a href="../../pycharm/configuration/">PyCharm の設定</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_python.html">python</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../python/note/">Python のメモ</a>
              </li>
            
              <li class="nav-article">
                <a href="../../python/etc/">Python いろいろメモ</a>
              </li>
            
              <li class="nav-article">
                <a href="../../python/pyconjp2018/">PyConJP 2018 で聞いた講演</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_redshift.html">redshift</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../redshift/note/">Redshift のメモ</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_sample.html">sample</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../2018/sample-table/">table の sample</a>
              </li>
            
              <li class="nav-article">
                <a href="../../2018/sample-h1-h2-h3-li/">h1, h2, h3, リストの sample</a>
              </li>
            
              <li class="nav-article">
                <a href="../../2018/sample-code-block/">code-block, 引用の sample</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_sql.html">sql</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../sql/note/">SQL のメモ</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_sqlalchemy.html">sqlalchemy</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../sqlalchemy/note/">SQLAlchemy メモ</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_ssh.html">ssh</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../ssh/command/ssh-keygen/">ssh-keygen</a>
              </li>
            
              <li class="nav-article">
                <a href="../../ssh/command/ssh-add/">ssh-add</a>
              </li>
            
              <li class="nav-article">
                <a href="../../ssh/command/ssh/">ssh のメモ</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_test.html">test</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../python-test/tox/">tox</a>
              </li>
            
              <li class="nav-article">
                <a href="../../python-test/mypy/">mypy</a>
              </li>
            
              <li class="nav-article">
                <a href="../../python-test/note/">Python テストのメモ</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_vagrant.html">vagrant</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../vagrant/note/">Vagrant のメモ</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_vim.html">vim</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../vim/command/">Vim のコマンド</a>
              </li>
            
          </ul>
        </li>
      
    </ul>
  </nav>
</header></div>
      <div class="main">
<div class="article-content">
  <main class="item item-article item-django">
    <time class="date" datetime="2019-05-05 00:00:00+09:00">
      2019-05-05 Sun
    </time>
    <div class="title">Django: View</div>
    <div class="category">
      <a href="/index_category_category_django.html">
          django
      </a>
    </div>
    <div class="text">
      <details>
<summary>目次</summary><div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#id1" id="id6">リファレンス/書籍</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id7">関数ベースのビュー</a></p></li>
<li><p><a class="reference internal" href="#class-based-views" id="id8">クラスベースのビュー (Class-based views)</a></p>
<ul>
<li><p><a class="reference internal" href="#as-view" id="id9">as_view</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#base-views" id="id10">Base views</a></p>
<ul>
<li><p><a class="reference internal" href="#view" id="id11">View</a></p></li>
<li><p><a class="reference internal" href="#templateview" id="id12">TemplateView</a></p>
<ul>
<li><p><a class="reference internal" href="#get-context-data" id="id13">get_context_data</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#redirectview" id="id14">RedirectView</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#generic-views" id="id15">いろいろな Generic views</a></p>
<ul>
<li><p><a class="reference internal" href="#listview" id="id16">ListView</a></p></li>
<li><p><a class="reference internal" href="#formview" id="id17">FormView</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id4" id="id18">ログイン・ログアウト</a></p>
<ul>
<li><p><a class="reference internal" href="#loginview-logoutview" id="id19">LoginView, LogoutView</a></p></li>
<li><p><a class="reference internal" href="#loginrequiredmixin" id="id20">LoginRequiredMixin</a></p></li>
</ul>
</li>
</ul>
</div>
</details><div class="section" id="id1">
<div class="md_header_block" id="h_%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9%E6%9B%B8%E7%B1%8D"><a class="md_header_anchor" id="a_%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9%E6%9B%B8%E7%B1%8D"></a><h1><a class="toc-backref" href="#id6">リファレンス/書籍</a></h1></div>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.djangoproject.com/ja/2.2/topics/class-based-views/">Django documentation &gt; クラスベースビュー</a></p></li>
<li><p><a class="reference external" href="https://docs.djangoproject.com/ja/2.2/ref/class-based-views/">Django documentation &gt; ビルトインのクラスベースビュー API</a></p></li>
<li><p><a class="reference external" href="https://www.amazon.co.jp/dp/B07GK7BWB7/">現場で使える Django の教科書</a></p></li>
<li><p><a class="reference external" href="http://note.crohaco.net/2015/django-genericview/">くろのて &gt; [Django]ジェネリックビューってなんなんだよ</a></p></li>
<li><p>crohaco さん、 shimizukawa さん、 tell-k さん</p></li>
</ul>
</div>
<div class="section" id="id3">
<div class="md_header_block" id="h_%E9%96%A2%E6%95%B0%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AE%E3%83%93%E3%83%A5%E3%83%BC"><a class="md_header_anchor" id="a_%E9%96%A2%E6%95%B0%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AE%E3%83%93%E3%83%A5%E3%83%BC"></a><h1><a class="toc-backref" href="#id7">関数ベースのビュー</a></h1></div>
<ul class="simple">
<li><p>第一引数に django.http.request.HttpRequest を受け取る</p></li>
<li><p>戻り値に django.http.response.HttpResponse を返す</p></li>
</ul>
<div class="code-block">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>


<span class="k">def</span> <span class="nf">HelloView</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">"""関数ベースのビュー"""</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">'GET'</span><span class="p">:</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">'message'</span><span class="p">:</span> <span class="s2">"Hello World!"</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># render:</span>
        <span class="c1">#   * HttpResponse を作ってくれる</span>
        <span class="c1">#   * テンプレートをレンダリングするとき使う</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'hello.html'</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="class-based-views">
<div class="md_header_block" id="h_%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AE%E3%83%93%E3%83%A5%E3%83%BCClassbasedviews"><a class="md_header_anchor" id="a_%E3%82%AF%E3%83%A9%E3%82%B9%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AE%E3%83%93%E3%83%A5%E3%83%BCClassbasedviews"></a><h1><a class="toc-backref" href="#id8">クラスベースのビュー (Class-based views)</a></h1></div>
<ul class="simple">
<li><p>関数形式の view はコンテキスト、テンプレート、フォーム、全部変えしてあげないといけなかった。つまり全部関数内に書く必要があった。
必要なものを切り離して属性として定義できるようにしたのが genericview (class based view)。</p></li>
<li><p>akiyoko さんは断然、クラスベースビューをお勧めするとのこと</p>
<ul>
<li><p>汎用ビュー (Generic View) としてさまざまな用途のクラスが提供されているのでその恩恵を受けられる</p></li>
<li><p>すべての基本となる基本汎用ビュー <span class="docutils literal">django.views.generic.base.View</span> を利用すれば見通しのよいビューが書けるし、応用も効く</p></li>
<li><p>汎用ビューのほかにも便利な Mixin クラスを多重継承してお決まりの処理を再利用できる</p></li>
</ul>
</li>
</ul>
<div class="code-block">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.views</span> <span class="kn">import</span> <span class="n">View</span>
<span class="c1"># from django.views.generic import View と同義↑</span>


<span class="k">class</span> <span class="nc">HelloView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="sd">"""クラスベースのビュー"""</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">'message'</span><span class="p">:</span> <span class="s2">"Hello World!"</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'hello.html'</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>


<span class="n">hello</span> <span class="o">=</span> <span class="n">HelloView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()</span>
</pre></div>
</div>
<div class="code-block">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">login</span> <span class="k">as</span> <span class="n">auth_login</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.views</span> <span class="kn">import</span> <span class="n">View</span>


<span class="k">class</span> <span class="nc">LoginView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">"""GET リクエスト"""</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">'form'</span><span class="p">:</span> <span class="n">LoginForm</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="c1"># ログイン画面用のテンプレートに値が空のフォームをレンダリング</span>
        <span class="c1"># render: テンプレートをレンダリングするとき使う</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'accounts/login.html'</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">"""POST リクエスト"""</span>
        <span class="c1"># リクエストからフォームを作成</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="c1"># バリデーション (ユーザーの認証も併せて実施)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="c1"># バリデーション NG の場合はログイン画面のテンプレートを再表示</span>
            <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'accounts/login.html'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>

        <span class="c1"># User オブジェクトをフォームから取得</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get_user</span><span class="p">()</span>

        <span class="c1"># ログイン処理 (取得した User オブジェクトをセッションに保存 &amp; User データを更新)</span>
        <span class="n">auth_login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>

        <span class="c1"># ショップ画面にリダイレクト</span>
        <span class="c1"># redirect: リダイレクトするとき使う</span>
        <span class="c1">#   * リダイレクト先のURLは reverse を使って取得する</span>
        <span class="c1">#   * ハードコーディングするなかれ</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">'shop:index'</span><span class="p">))</span>
</pre></div>
</div>
<div class="section" id="as-view">
<div class="md_header_block" id="h_as_view"><a class="md_header_anchor" id="a_as_view"></a><h2><a class="toc-backref" href="#id9">as_view</a></h2></div>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/django/django/blob/master/django/views/generic/base.py#L49">https://github.com/django/django/blob/master/django/views/generic/base.py#L49</a></p></li>
<li><p>クラスベースのビューをビュー関数化してくれるメソッド</p>
<ul>
<li><p>as_view は view 関数を生成して返している</p></li>
<li><p>これをしておくと、URL ディスパッチャだけでなく他のビューからも呼び出せるようになる</p></li>
<li><p>実際の処理は self.dispatch で クラスベースビューに処理を委譲してるんだと思います</p></li>
</ul>
</li>
<li><p>urls.py で as_view せずに、 views.py で as_view した Class-based view をグローバル変数に代入するとうれしいタイミング</p>
<ul>
<li><p>同じ view を複数の url に設定したい</p>
<ul>
<li><p>モジュールの import が1回しか発生しないのはモジュール毎の話じゃなくプロセス全体 ( Django で言うと <span class="docutils literal"><span class="pre">runserver...</span></span> した単位) の話</p></li>
<li><p>url ごとに同じ View を何回も生成するんだったら、同じでよい (シングルトン)</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="base-views">
<div class="md_header_block" id="h_Baseviews"><a class="md_header_anchor" id="a_Baseviews"></a><h1><a class="toc-backref" href="#id10">Base views</a></h1></div>
<div class="section" id="view">
<div class="md_header_block" id="h_View"><a class="md_header_anchor" id="a_View"></a><h2><a class="toc-backref" href="#id11">View</a></h2></div>
<ul class="simple">
<li><p>django.views.generic.base.View</p></li>
<li><p>すべての元となるクラスベースビューです。他の全てのクラスベースビューは、この基本クラスを継承しています。</p></li>
</ul>
</div>
<div class="section" id="templateview">
<div class="md_header_block" id="h_TemplateView"><a class="md_header_anchor" id="a_TemplateView"></a><h2><a class="toc-backref" href="#id12">TemplateView</a></h2></div>
<ul class="simple">
<li><p>テンプレートを表示することに特化した Generic View</p></li>
<li><p>トップ画面やヘルプ画面などの単純なテンプレートを表示するのによく使う</p></li>
<li><p>オーバーライドできる変数やメソッドがいくつか用意されていて、デフォルトの挙動をある程度自由に変更できる</p></li>
</ul>
<div class="code-block">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">TemplateView</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>


<span class="k">class</span> <span class="nc">IndexView</span><span class="p">(</span><span class="n">TemplateView</span><span class="p">):</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'index.html'</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># get_context_data をオーバーライドした例</span>
        <span class="c1"># テンプレートに渡すコンテキストに任意の変数を追加できる</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">IndexView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># テンプレートに渡すコンテキストに `user_count` という変数を追加</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">'user_count'</span><span class="p">]</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">context</span>


<span class="n">index</span> <span class="o">=</span> <span class="n">IndexView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="get-context-data">
<div class="md_header_block" id="h_get_context_data"><a class="md_header_anchor" id="a_get_context_data"></a><h3><a class="toc-backref" href="#id13">get_context_data</a></h3></div>
<ul class="simple">
<li><p>大抵の場合、ビューというのはレンダリングに必要なコンテキストを組み立てるものなので 大体の処理は <span class="docutils literal">get_context_data</span> というメソッドに書く。</p></li>
</ul>
</div>
</div>
<div class="section" id="redirectview">
<div class="md_header_block" id="h_RedirectView"><a class="md_header_anchor" id="a_RedirectView"></a><h2><a class="toc-backref" href="#id14">RedirectView</a></h2></div>
<ul class="simple">
<li><p>リダイレクトに特化した Generic View</p></li>
<li><p>任意の URL にリダイレクトすることに特化したやつ</p></li>
</ul>
<div class="code-block">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">RedirectView</span>


<span class="k">class</span> <span class="nc">IndexView</span><span class="p">(</span><span class="n">RedirectView</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">'/accounts/login/'</span>
    <span class="c1"># pattern_name = 'accounts:login'  # パターンで URL を指定する場合</span>

    <span class="k">def</span> <span class="nf">get_redirect_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># リダイレクトする URL を動的に組み立てるためのやつをオーバーライドできる</span>
        <span class="k">pass</span>


<span class="n">index</span> <span class="o">=</span> <span class="n">IndexView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="generic-views">
<div class="md_header_block" id="h_%E3%81%84%E3%82%8D%E3%81%84%E3%82%8D%E3%81%AAGenericviews"><a class="md_header_anchor" id="a_%E3%81%84%E3%82%8D%E3%81%84%E3%82%8D%E3%81%AAGenericviews"></a><h1><a class="toc-backref" href="#id15">いろいろな Generic views</a></h1></div>
<ul class="simple">
<li><p>これが便利とのこと: <a class="reference external" href="https://ccbv.co.uk/">https://ccbv.co.uk/</a></p></li>
</ul>
<div class="section" id="listview">
<div class="md_header_block" id="h_ListView"><a class="md_header_anchor" id="a_ListView"></a><h2><a class="toc-backref" href="#id16">ListView</a></h2></div>
<ul class="simple">
<li><p>モデルオブジェクトの一覧を表示するための View</p></li>
</ul>
<div class="code-block">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Book</span>


<span class="k">class</span> <span class="nc">BookListView1</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="c1"># リストしたいモデルを指定する</span>
    <span class="c1"># これだけで、 `shop/book_list.html` という名前のテンプレートに、</span>
    <span class="c1"># object_list (or book_list) という変数名で、</span>
    <span class="c1"># Book モデルの全てのレコードの一覧を渡してくれる</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
</pre></div>
</div>
<div class="code-block">
<div class="highlight"><pre><span></span><span class="c1"># ほかにもいろいろある...</span>
<span class="c1"># 利用するテンプレートを指定する</span>
<span class="n">template_name</span> <span class="o">=</span> <span class="s1">'husky.html'</span>
<span class="c1"># オブジェクトの一覧を取得するためのクエリセットを指定する</span>
<span class="n">queryset</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">price__gt</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="formview">
<div class="md_header_block" id="h_FormView"><a class="md_header_anchor" id="a_FormView"></a><h2><a class="toc-backref" href="#id17">FormView</a></h2></div>
<ul class="simple">
<li><p>何らかの登録・更新処理で <span class="docutils literal">form</span> を使ったバリデーションが必要なら 大体 <span class="docutils literal">FormView</span> を使う</p></li>
</ul>
</div>
</div>
<div class="section" id="id4">
<div class="md_header_block" id="h_%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%83%AD%E3%82%B0%E3%82%A2%E3%82%A6%E3%83%88"><a class="md_header_anchor" id="a_%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%83%AD%E3%82%B0%E3%82%A2%E3%82%A6%E3%83%88"></a><h1><a class="toc-backref" href="#id18">ログイン・ログアウト</a></h1></div>
<ul class="simple">
<li><p><a class="reference external" href="https://www.amazon.co.jp/dp/B07GK7BWB7/">現場で使える Django の教科書</a> P.43 によく書いてあるのでそちらを参照のこと</p>
<ul>
<li><p>request.user:</p>
<ul>
<li><p>ログイン済: User オブジェクト</p></li>
<li><p>未ログイン: AnonymousUser オブジェクト</p></li>
</ul>
</li>
<li><p>ログイン済みか否か: request.user.is_authenticated</p></li>
<li><p>ログアウトすると、</p>
<ul>
<li><p>サーバーのセッションクリア</p></li>
<li><p>request.user に AnonymousUser をセット</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="section" id="loginview-logoutview">
<div class="md_header_block" id="h_LoginViewLogoutView"><a class="md_header_anchor" id="a_LoginViewLogoutView"></a><h2><a class="toc-backref" href="#id19">LoginView, LogoutView</a></h2></div>
<ul class="simple">
<li><p>ログインに特化した View: django.contrib.auth.views.LoginView</p></li>
<li><p>ログアウトに特化した View: django.contrib.auth.views.LogoutView</p></li>
</ul>
<div class="code-block">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.views</span> <span class="kn">import</span> <span class="n">LoginView</span> <span class="k">as</span> <span class="n">AuthLoginView</span>


<span class="k">class</span> <span class="nc">LoginView</span><span class="p">(</span><span class="n">AuthLoginView</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    ログインビューの実装例</span>

<span class="sd">    * 設定値の調整が必要になることもあるよ</span>

<span class="sd">      * LOGIN_URL</span>
<span class="sd">      * LOGIN_REDIRECT_URL</span>
<span class="sd">      * LOGOUT_REDIRECT_URL</span>
<span class="sd">    """</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'accounts/login.html'</span>
</pre></div>
</div>
</div>
<div class="section" id="loginrequiredmixin">
<div class="md_header_block" id="h_LoginRequiredMixin"><a class="md_header_anchor" id="a_LoginRequiredMixin"></a><h2><a class="toc-backref" href="#id20">LoginRequiredMixin</a></h2></div>
<ul class="simple">
<li><p>LoginRequiredMixin: 未ログインのユーザーがアクセスしようとしたときに何らかのペナルティを課すための Mixin</p>
<ul>
<li><p>Django1.9 から導入された</p></li>
<li><p>継承すると、未ログインユーザーがアクセスしたらば LOGIN_URL で定義した URL にリダイレクトしてくれるよ</p></li>
</ul>
</li>
</ul>
<div class="code-block">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.mixins</span> <span class="kn">import</span> <span class="n">LoginRequiredMixin</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Book</span>


<span class="k">class</span> <span class="nc">BookListView</span><span class="p">(</span><span class="n">LoginRequiredMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
    <span class="c1"># 403 エラー画面を表示する場合は次のコメントアウトを外す</span>
    <span class="c1"># raise_exception = True</span>
</pre></div>
</div>
</div>
</div>
    </div>
  </main>
</div>
</div>
    </div>
  </body>

</html>