<!DOCTYPE html>
<html lang="ja-JP">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <title>ProxyCommand とは何ですか/32imuf.com</title>
    <link rel="shortcut icon" href="/static/icons/favicon.ico">
    <link href="https://fonts.googleapis.com/css?family=Griffy" rel="stylesheet">
    <link href="https://fonts.googleapis.com/earlyaccess/sawarabimincho.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/reset.css">
    <link rel="stylesheet" href="/static/css/style.css?20180821">
    
  <link rel="stylesheet" href="/static/css/article.css?20180923">
  <link rel="stylesheet" href="/static/css/monokai.css">

  </head>

  <body>
    <div class="container">
      <div class="header"><header class="item item-header">
  <h1>
    <a href="/">
      <img class="logo" src="/static/images/inuu.png" alt="犬">
    </a>
  </h1>
  <nav class="nav">
    <ul>
      <li class="nav-category"><a href="/">HOME</a></li>
      
      
        
        <li class="nav-category">
          <a href="/index_category_category_aws.html">aws</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../aws/s3-response-error/">S3ResponseError の原因はなんと時刻ずれだった</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_blog.html">blog</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../blog/rules/">ブログを書くときの注意点</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_css.html">css</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../html-css/css/note/">CSS のメモ</a>
              </li>
            
              <li class="nav-article">
                <a href="../../html-css/html5-css3-modern-coding/">『HTML5/CSS3モダンコーディング フロントエンドエンジニアが教える3つの本格レイアウト スタンダード・グリッド・シングルページレイアウトの作り方』を読んで気になったことメモ</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_django.html">django</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../django/django_orm/">Django ORM のメモ</a>
              </li>
            
              <li class="nav-article">
                <a href="../../django/note/">Django のメモ</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_git.html">git</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../git/rebase-i/">git rebase -i</a>
              </li>
            
              <li class="nav-article">
                <a href="../../git/rebase/">git rebase</a>
              </li>
            
              <li class="nav-article">
                <a href="../../git/note/">Git のメモ</a>
              </li>
            
              <li class="nav-article">
                <a href="../../git/configuration/">Git の設定まとめ</a>
              </li>
            
              <li class="nav-article">
                <a href="../../git/command/">Git のコマンドまとめ</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_github.html">github</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../github/how-to-create-new-repository/">GitHub に新しいリポジトリを作成して、pushする</a>
              </li>
            
              <li class="nav-article">
                <a href="../../github/github-pages-custom-domain-setting/">GitHub Pages にカスタムドメインを設定する</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_mac.html">mac</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../mac/note/">Mac のメモ</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_miyadaiku.html">miyadaiku</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../miyadaiku/build/">Miyadaiku ビルドするときのコマンド</a>
              </li>
            
              <li class="nav-article">
                <a href="../../miyadaiku/article-directory-structure/">article の置きかた</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_pycharm.html">pycharm</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../pycharm/django-support/">Pycharm の Django support を使う</a>
              </li>
            
              <li class="nav-article">
                <a href="../../pycharm/add-psql-var-to-user-params-for-db-console/">PyCharm の Database Console で PostgreSQL のプレースホルダー (インタポレーション) を SQL パラメーターとして使えるようにする</a>
              </li>
            
              <li class="nav-article">
                <a href="../../pycharm/connect-db-using-ssh-tunnel/">PyCharm で SSH tunnel して Amazon Redshift につなぐ</a>
              </li>
            
              <li class="nav-article">
                <a href="../../pycharm/useful-menu-and-shortcuts/">PyCharm ショートカットと便利メニュー</a>
              </li>
            
              <li class="nav-article">
                <a href="../../pycharm/configuration/">PyCharm の設定</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_python.html">python</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../python/note/">Python のメモ</a>
              </li>
            
              <li class="nav-article">
                <a href="../../python/etc/">Python いろいろメモ</a>
              </li>
            
              <li class="nav-article">
                <a href="../../python/pyconjp2018/">PyConJP 2018 で聞いた講演</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_redshift.html">redshift</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../redshift/note/">Redshift のメモ</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_sample.html">sample</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../2018/sample-h1-h2-h3-li/">h1, h2, h3, リストの sample</a>
              </li>
            
              <li class="nav-article">
                <a href="../../2018/sample-code-block/">code-block, 引用の sample</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_sql.html">sql</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../sql/note/">SQL のメモ</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_test.html">test</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../python-test/note/">Python テストのメモ</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_vagrant.html">vagrant</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../vagrant/note/">Vagrant のメモ</a>
              </li>
            
          </ul>
        </li>
      
        
        <li class="nav-category">
          <a href="/index_category_category_vim.html">vim</a>
          <ul>
            
              <li class="nav-article">
                <a href="../../vim/command/">Vim のコマンド</a>
              </li>
            
          </ul>
        </li>
      
    </ul>
  </nav>
</header></div>
      <div class="main">
  <main class="item item-article item-ssh">
    <time class="date" datetime="2018-08-05 00:00:00+09:00">
      2018-08-05 Sun
    </time>
    <div class="title">ProxyCommand とは何ですか</div>
    <div class="category">
      <a href="/index_category_category_ssh.html">
          ssh
      </a>
    </div>
    <div class="text">
      <p>TODO: 引用の要件を満たす</p>
<ul class="simple">
<li><p>キーワードやオプションの意味、のところに英語だけじゃなくて、自分の解釈つけとこう</p></li>
<li><p>host 名とかをもうちょっとわかりやすくしておきたい</p></li>
</ul>
<div class="section" id="id1">
<div class="header_target" id="h_ssh_ssh_2dconfig_2dproxy_2dcommand_index_2erst_1"></div><h1>ある日</h1>
<p>ssh-config を眺めていたら、こうなっていました。</p>
<ul>
<li><p>~/.ssh/config</p>
<div class="code-block">
<div class="highlight"><pre><span></span>ForwardAgent yes
ServerAliveInterval <span class="m">300</span>

<span class="c1"># ホスト A</span>
Host my-gateway
  HostName      my.gateway.com
  User          myuser
  IdentityFile  ~/.ssh/id_rsa

<span class="c1"># ホスト B</span>
Host myhost
  HostName      myhost-name
  User          myuser
  ProxyCommand  ssh -W %h:%p my-gateway  <span class="c1"># &lt;- ここが不思議</span>
</pre></div>
</div>
</li>
</ul>
<p>今まで、とにかく無事につながってくれさえすれば何でもよいと思ってきましたが、これは何ですか・・・</p>
</div>
<div class="section" id="id2">
<div class="header_target" id="h_ssh_ssh_2dconfig_2dproxy_2dcommand_index_2erst_2"></div><h1>こういうことでした</h1>
<p>ローカルから、ホスト B へ ssh する際に、</p>
<div class="code-block">
<div class="highlight"><pre><span></span>$ ssh myhost
</pre></div>
</div>
<p>としていたのですが、間にもっとたくさんはさまっていました。</p>
<div class="section" id="id3">
<div class="header_target" id="h_ssh_ssh_2dconfig_2dproxy_2dcommand_index_2erst_3"></div><h2>間にはさまっていたこと</h2>
<ol class="arabic simple">
<li><p>ホスト B へ行くのに、</p></li>
<li><p>ホスト A に <cite>IdentityFile</cite> で ssh 接続したあと、</p></li>
<li><p>ホスト A から、ホスト B に ssh 接続する、</p></li>
<li><p><cite>ForwardAgent yes</cite> しているから、鍵はそのまま転送ね。</p></li>
</ol>
</div>
<div class="section" id="id4">
<div class="header_target" id="h_ssh_ssh_2dconfig_2dproxy_2dcommand_index_2erst_4"></div><h2>キーワードやオプションの意味</h2>
<ul>
<li><p>ssh_config のマニュアルページの <span class="docutils literal">ProxyCommand</span> の説明</p>
<pre class="literal-block">Specifies the command to use to connect to the server.
The command string extends to the end of the line, and is executed with the user's shell.
In the command string, `%h' will be substituted by the host name to connect and `%p' by the port.
The command can be basically anything, and should read from its standard input and write to its standard output.</pre>
</li>
<li><p>ssh のマニュアルページの <span class="docutils literal"><span class="pre">-W</span></span> オプションの説明</p>
<pre class="literal-block">-W host:port
  Requests that standard input and output on the client be forwarded to host on port over the secure channel.</pre>
</li>
</ul>
</div>
</div>
<div class="section" id="id5">
<div class="header_target" id="h_ssh_ssh_2dconfig_2dproxy_2dcommand_index_2erst_5"></div><h1>参考にしたページ</h1>
<ul class="simple">
<li><p><a class="reference external" href="https://www.freebsd.org/cgi/man.cgi?query=ssh_config&amp;apropos=0&amp;sektion=0&amp;manpath=CentOS+6.5&amp;arch=default&amp;format=html">SSH_CONFIG(5)</a></p></li>
<li><p><a class="reference external" href="https://www.freebsd.org/cgi/man.cgi?query=ssh&amp;apropos=0&amp;sektion=0&amp;manpath=CentOS+6.5&amp;arch=default&amp;format=html">SSH(1)</a></p></li>
<li><p><a class="reference external" href="http://note.crohaco.net/2017/ssh-tunnel/#proxycommand">ProxyCommand</a></p></li>
</ul>
<p>ありがとうございました。</p>
</div>
    </div>
  </main>
</div>
    </div>
  </body>

</html>